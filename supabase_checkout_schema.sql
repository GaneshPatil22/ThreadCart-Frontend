-- ============================================================================
-- CHECKOUT SCHEMA
-- ============================================================================
-- Phase 1: Database tables for checkout flow
-- Run this in Supabase SQL Editor
-- ============================================================================

-- ============================================================================
-- 1. SUPPORTED PINCODES TABLE
-- ============================================================================
-- Whitelist of serviceable pincodes with city/state auto-fill

CREATE TABLE IF NOT EXISTS public.supported_pincodes (
  pincode VARCHAR(6) PRIMARY KEY,
  city TEXT NOT NULL,
  state TEXT NOT NULL,
  delivery_days INTEGER DEFAULT 5,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Add comment for documentation
COMMENT ON TABLE public.supported_pincodes IS 'Whitelist of serviceable pincodes for delivery';

-- ============================================================================
-- 2. USER ADDRESSES TABLE
-- ============================================================================
-- Store user shipping addresses (one address per user for now)

CREATE TABLE IF NOT EXISTS public.user_addresses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  full_name TEXT NOT NULL,
  phone VARCHAR(15) NOT NULL,
  address_line1 TEXT NOT NULL,
  address_line2 TEXT,
  city TEXT NOT NULL,
  state TEXT NOT NULL,
  pincode VARCHAR(6) NOT NULL,
  country TEXT DEFAULT 'India',
  is_default BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),

  -- Ensure pincode is valid (references supported_pincodes)
  CONSTRAINT fk_pincode FOREIGN KEY (pincode) REFERENCES public.supported_pincodes(pincode),

  -- One default address per user
  CONSTRAINT unique_default_per_user UNIQUE (user_id, is_default)
    DEFERRABLE INITIALLY DEFERRED
);

-- Index for faster lookups
CREATE INDEX IF NOT EXISTS idx_user_addresses_user_id ON public.user_addresses(user_id);

-- Add comment for documentation
COMMENT ON TABLE public.user_addresses IS 'User shipping addresses for checkout';

-- ============================================================================
-- 3. ROW LEVEL SECURITY (RLS)
-- ============================================================================

-- Enable RLS on supported_pincodes
ALTER TABLE public.supported_pincodes ENABLE ROW LEVEL SECURITY;

-- Anyone can view active pincodes (for validation)
CREATE POLICY "Anyone can view active pincodes"
ON public.supported_pincodes FOR SELECT
USING (is_active = true);

-- Only admin can manage pincodes
CREATE POLICY "Admin can manage pincodes"
ON public.supported_pincodes FOR ALL
USING (auth.jwt() ->> 'email' = 'superadmin@threadcart.com')
WITH CHECK (auth.jwt() ->> 'email' = 'superadmin@threadcart.com');

-- Enable RLS on user_addresses
ALTER TABLE public.user_addresses ENABLE ROW LEVEL SECURITY;

-- Users can view their own addresses
CREATE POLICY "Users can view own addresses"
ON public.user_addresses FOR SELECT
USING (auth.uid() = user_id);

-- Users can insert their own addresses
CREATE POLICY "Users can insert own addresses"
ON public.user_addresses FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- Users can update their own addresses
CREATE POLICY "Users can update own addresses"
ON public.user_addresses FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);

-- Users can delete their own addresses
CREATE POLICY "Users can delete own addresses"
ON public.user_addresses FOR DELETE
USING (auth.uid() = user_id);

-- ============================================================================
-- 4. SAMPLE PINCODES DATA
-- ============================================================================
-- Add sample pincodes for testing (India major cities)

INSERT INTO public.supported_pincodes (pincode, city, state, delivery_days) VALUES
  -- Maharashtra
  ('400001', 'Mumbai', 'Maharashtra', 3),
  ('400002', 'Mumbai', 'Maharashtra', 3),
  ('400003', 'Mumbai', 'Maharashtra', 3),
  ('400004', 'Mumbai', 'Maharashtra', 3),
  ('400005', 'Mumbai', 'Maharashtra', 3),
  ('400050', 'Mumbai', 'Maharashtra', 3),
  ('400051', 'Mumbai', 'Maharashtra', 3),
  ('400052', 'Mumbai', 'Maharashtra', 3),
  ('400053', 'Mumbai', 'Maharashtra', 3),
  ('400054', 'Mumbai', 'Maharashtra', 3),
  ('400055', 'Mumbai', 'Maharashtra', 3),
  ('400056', 'Mumbai', 'Maharashtra', 3),
  ('400057', 'Mumbai', 'Maharashtra', 3),
  ('400058', 'Mumbai', 'Maharashtra', 3),
  ('400059', 'Mumbai', 'Maharashtra', 3),
  ('400060', 'Mumbai', 'Maharashtra', 3),
  ('400061', 'Mumbai', 'Maharashtra', 3),
  ('400062', 'Mumbai', 'Maharashtra', 3),
  ('400063', 'Mumbai', 'Maharashtra', 3),
  ('400064', 'Mumbai', 'Maharashtra', 3),
  ('400065', 'Mumbai', 'Maharashtra', 3),
  ('400066', 'Mumbai', 'Maharashtra', 3),
  ('400067', 'Mumbai', 'Maharashtra', 3),
  ('400068', 'Mumbai', 'Maharashtra', 3),
  ('400069', 'Mumbai', 'Maharashtra', 3),
  ('400070', 'Mumbai', 'Maharashtra', 3),
  ('400071', 'Mumbai', 'Maharashtra', 3),
  ('400072', 'Mumbai', 'Maharashtra', 3),
  ('400076', 'Mumbai', 'Maharashtra', 3),
  ('400077', 'Mumbai', 'Maharashtra', 3),
  ('400078', 'Mumbai', 'Maharashtra', 3),
  ('400079', 'Mumbai', 'Maharashtra', 3),
  ('400080', 'Mumbai', 'Maharashtra', 3),
  ('400081', 'Mumbai', 'Maharashtra', 3),
  ('400082', 'Mumbai', 'Maharashtra', 3),
  ('400083', 'Mumbai', 'Maharashtra', 3),
  ('400084', 'Mumbai', 'Maharashtra', 3),
  ('400086', 'Mumbai', 'Maharashtra', 3),
  ('400087', 'Mumbai', 'Maharashtra', 3),
  ('400088', 'Mumbai', 'Maharashtra', 3),
  ('400089', 'Mumbai', 'Maharashtra', 3),
  ('400091', 'Mumbai', 'Maharashtra', 3),
  ('400092', 'Mumbai', 'Maharashtra', 3),
  ('400093', 'Mumbai', 'Maharashtra', 3),
  ('400094', 'Mumbai', 'Maharashtra', 3),
  ('400095', 'Mumbai', 'Maharashtra', 3),
  ('400096', 'Mumbai', 'Maharashtra', 3),
  ('400097', 'Mumbai', 'Maharashtra', 3),
  ('400098', 'Mumbai', 'Maharashtra', 3),
  ('400099', 'Mumbai', 'Maharashtra', 3),
  ('400101', 'Mumbai', 'Maharashtra', 3),
  ('400102', 'Mumbai', 'Maharashtra', 3),
  ('400103', 'Mumbai', 'Maharashtra', 3),
  ('400104', 'Mumbai', 'Maharashtra', 3),
  ('411001', 'Pune', 'Maharashtra', 4),
  ('411002', 'Pune', 'Maharashtra', 4),
  ('411003', 'Pune', 'Maharashtra', 4),
  ('411004', 'Pune', 'Maharashtra', 4),
  ('411005', 'Pune', 'Maharashtra', 4),
  ('411006', 'Pune', 'Maharashtra', 4),
  ('411007', 'Pune', 'Maharashtra', 4),
  ('411008', 'Pune', 'Maharashtra', 4),
  ('411009', 'Pune', 'Maharashtra', 4),
  ('411011', 'Pune', 'Maharashtra', 4),
  ('411012', 'Pune', 'Maharashtra', 4),
  ('411013', 'Pune', 'Maharashtra', 4),
  ('411014', 'Pune', 'Maharashtra', 4),
  ('411015', 'Pune', 'Maharashtra', 4),
  ('411016', 'Pune', 'Maharashtra', 4),
  ('411017', 'Pune', 'Maharashtra', 4),
  ('411018', 'Pune', 'Maharashtra', 4),
  ('411019', 'Pune', 'Maharashtra', 4),
  ('411020', 'Pune', 'Maharashtra', 4),
  ('411021', 'Pune', 'Maharashtra', 4),
  ('411022', 'Pune', 'Maharashtra', 4),
  ('411026', 'Pune', 'Maharashtra', 4),
  ('411027', 'Pune', 'Maharashtra', 4),
  ('411028', 'Pune', 'Maharashtra', 4),
  ('411029', 'Pune', 'Maharashtra', 4),
  ('411030', 'Pune', 'Maharashtra', 4),
  ('411032', 'Pune', 'Maharashtra', 4),
  ('411033', 'Pune', 'Maharashtra', 4),
  ('411034', 'Pune', 'Maharashtra', 4),
  ('411035', 'Pune', 'Maharashtra', 4),
  ('411036', 'Pune', 'Maharashtra', 4),
  ('411037', 'Pune', 'Maharashtra', 4),
  ('411038', 'Pune', 'Maharashtra', 4),
  ('411039', 'Pune', 'Maharashtra', 4),
  ('411040', 'Pune', 'Maharashtra', 4),
  ('411041', 'Pune', 'Maharashtra', 4),
  ('411042', 'Pune', 'Maharashtra', 4),
  ('411043', 'Pune', 'Maharashtra', 4),
  ('411044', 'Pune', 'Maharashtra', 4),
  ('411045', 'Pune', 'Maharashtra', 4),
  ('411046', 'Pune', 'Maharashtra', 4),
  ('411047', 'Pune', 'Maharashtra', 4),
  ('411048', 'Pune', 'Maharashtra', 4),
  ('411051', 'Pune', 'Maharashtra', 4),
  ('411052', 'Pune', 'Maharashtra', 4),
  ('411057', 'Pune', 'Maharashtra', 4),
  ('411058', 'Pune', 'Maharashtra', 4),
  ('440001', 'Nagpur', 'Maharashtra', 5),
  ('440002', 'Nagpur', 'Maharashtra', 5),
  ('440003', 'Nagpur', 'Maharashtra', 5),
  ('440004', 'Nagpur', 'Maharashtra', 5),
  ('440005', 'Nagpur', 'Maharashtra', 5),
  ('440006', 'Nagpur', 'Maharashtra', 5),
  ('440008', 'Nagpur', 'Maharashtra', 5),
  ('440009', 'Nagpur', 'Maharashtra', 5),
  ('440010', 'Nagpur', 'Maharashtra', 5),
  ('440012', 'Nagpur', 'Maharashtra', 5),
  ('440013', 'Nagpur', 'Maharashtra', 5),
  ('440014', 'Nagpur', 'Maharashtra', 5),
  ('440015', 'Nagpur', 'Maharashtra', 5),
  ('440016', 'Nagpur', 'Maharashtra', 5),
  ('440017', 'Nagpur', 'Maharashtra', 5),
  ('440018', 'Nagpur', 'Maharashtra', 5),
  ('440019', 'Nagpur', 'Maharashtra', 5),
  ('440020', 'Nagpur', 'Maharashtra', 5),
  ('440021', 'Nagpur', 'Maharashtra', 5),
  ('440022', 'Nagpur', 'Maharashtra', 5),
  ('440023', 'Nagpur', 'Maharashtra', 5),
  ('440024', 'Nagpur', 'Maharashtra', 5),
  ('440025', 'Nagpur', 'Maharashtra', 5),
  ('440026', 'Nagpur', 'Maharashtra', 5),
  ('440027', 'Nagpur', 'Maharashtra', 5),
  ('440030', 'Nagpur', 'Maharashtra', 5),
  ('440032', 'Nagpur', 'Maharashtra', 5),
  ('440033', 'Nagpur', 'Maharashtra', 5),
  ('440034', 'Nagpur', 'Maharashtra', 5),
  ('440035', 'Nagpur', 'Maharashtra', 5),

  -- Delhi
  ('110001', 'New Delhi', 'Delhi', 3),
  ('110002', 'New Delhi', 'Delhi', 3),
  ('110003', 'New Delhi', 'Delhi', 3),
  ('110004', 'New Delhi', 'Delhi', 3),
  ('110005', 'New Delhi', 'Delhi', 3),
  ('110006', 'New Delhi', 'Delhi', 3),
  ('110007', 'New Delhi', 'Delhi', 3),
  ('110008', 'New Delhi', 'Delhi', 3),
  ('110009', 'New Delhi', 'Delhi', 3),
  ('110010', 'New Delhi', 'Delhi', 3),
  ('110011', 'New Delhi', 'Delhi', 3),
  ('110012', 'New Delhi', 'Delhi', 3),
  ('110013', 'New Delhi', 'Delhi', 3),
  ('110014', 'New Delhi', 'Delhi', 3),
  ('110015', 'New Delhi', 'Delhi', 3),
  ('110016', 'New Delhi', 'Delhi', 3),
  ('110017', 'New Delhi', 'Delhi', 3),
  ('110018', 'New Delhi', 'Delhi', 3),
  ('110019', 'New Delhi', 'Delhi', 3),
  ('110020', 'New Delhi', 'Delhi', 3),
  ('110021', 'New Delhi', 'Delhi', 3),
  ('110022', 'New Delhi', 'Delhi', 3),
  ('110023', 'New Delhi', 'Delhi', 3),
  ('110024', 'New Delhi', 'Delhi', 3),
  ('110025', 'New Delhi', 'Delhi', 3),
  ('110026', 'New Delhi', 'Delhi', 3),
  ('110027', 'New Delhi', 'Delhi', 3),
  ('110028', 'New Delhi', 'Delhi', 3),
  ('110029', 'New Delhi', 'Delhi', 3),
  ('110030', 'New Delhi', 'Delhi', 3),
  ('110031', 'New Delhi', 'Delhi', 3),
  ('110032', 'New Delhi', 'Delhi', 3),
  ('110033', 'New Delhi', 'Delhi', 3),
  ('110034', 'New Delhi', 'Delhi', 3),
  ('110035', 'New Delhi', 'Delhi', 3),
  ('110036', 'New Delhi', 'Delhi', 3),
  ('110037', 'New Delhi', 'Delhi', 3),
  ('110038', 'New Delhi', 'Delhi', 3),
  ('110039', 'New Delhi', 'Delhi', 3),
  ('110040', 'New Delhi', 'Delhi', 3),
  ('110041', 'New Delhi', 'Delhi', 3),
  ('110042', 'New Delhi', 'Delhi', 3),
  ('110043', 'New Delhi', 'Delhi', 3),
  ('110044', 'New Delhi', 'Delhi', 3),
  ('110045', 'New Delhi', 'Delhi', 3),
  ('110046', 'New Delhi', 'Delhi', 3),
  ('110047', 'New Delhi', 'Delhi', 3),
  ('110048', 'New Delhi', 'Delhi', 3),
  ('110049', 'New Delhi', 'Delhi', 3),
  ('110051', 'New Delhi', 'Delhi', 3),
  ('110052', 'New Delhi', 'Delhi', 3),
  ('110053', 'New Delhi', 'Delhi', 3),
  ('110054', 'New Delhi', 'Delhi', 3),
  ('110055', 'New Delhi', 'Delhi', 3),
  ('110056', 'New Delhi', 'Delhi', 3),
  ('110057', 'New Delhi', 'Delhi', 3),
  ('110058', 'New Delhi', 'Delhi', 3),
  ('110059', 'New Delhi', 'Delhi', 3),
  ('110060', 'New Delhi', 'Delhi', 3),
  ('110061', 'New Delhi', 'Delhi', 3),
  ('110062', 'New Delhi', 'Delhi', 3),
  ('110063', 'New Delhi', 'Delhi', 3),
  ('110064', 'New Delhi', 'Delhi', 3),
  ('110065', 'New Delhi', 'Delhi', 3),
  ('110066', 'New Delhi', 'Delhi', 3),
  ('110067', 'New Delhi', 'Delhi', 3),
  ('110068', 'New Delhi', 'Delhi', 3),
  ('110069', 'New Delhi', 'Delhi', 3),
  ('110070', 'New Delhi', 'Delhi', 3),
  ('110071', 'New Delhi', 'Delhi', 3),
  ('110072', 'New Delhi', 'Delhi', 3),
  ('110073', 'New Delhi', 'Delhi', 3),
  ('110074', 'New Delhi', 'Delhi', 3),
  ('110075', 'New Delhi', 'Delhi', 3),
  ('110076', 'New Delhi', 'Delhi', 3),
  ('110077', 'New Delhi', 'Delhi', 3),
  ('110078', 'New Delhi', 'Delhi', 3),
  ('110080', 'New Delhi', 'Delhi', 3),
  ('110081', 'New Delhi', 'Delhi', 3),
  ('110082', 'New Delhi', 'Delhi', 3),
  ('110083', 'New Delhi', 'Delhi', 3),
  ('110084', 'New Delhi', 'Delhi', 3),
  ('110085', 'New Delhi', 'Delhi', 3),
  ('110086', 'New Delhi', 'Delhi', 3),
  ('110087', 'New Delhi', 'Delhi', 3),
  ('110088', 'New Delhi', 'Delhi', 3),
  ('110089', 'New Delhi', 'Delhi', 3),
  ('110090', 'New Delhi', 'Delhi', 3),
  ('110091', 'New Delhi', 'Delhi', 3),
  ('110092', 'New Delhi', 'Delhi', 3),
  ('110093', 'New Delhi', 'Delhi', 3),
  ('110094', 'New Delhi', 'Delhi', 3),
  ('110095', 'New Delhi', 'Delhi', 3),
  ('110096', 'New Delhi', 'Delhi', 3),

  -- Karnataka
  ('560001', 'Bangalore', 'Karnataka', 4),
  ('560002', 'Bangalore', 'Karnataka', 4),
  ('560003', 'Bangalore', 'Karnataka', 4),
  ('560004', 'Bangalore', 'Karnataka', 4),
  ('560005', 'Bangalore', 'Karnataka', 4),
  ('560006', 'Bangalore', 'Karnataka', 4),
  ('560007', 'Bangalore', 'Karnataka', 4),
  ('560008', 'Bangalore', 'Karnataka', 4),
  ('560009', 'Bangalore', 'Karnataka', 4),
  ('560010', 'Bangalore', 'Karnataka', 4),
  ('560011', 'Bangalore', 'Karnataka', 4),
  ('560012', 'Bangalore', 'Karnataka', 4),
  ('560013', 'Bangalore', 'Karnataka', 4),
  ('560014', 'Bangalore', 'Karnataka', 4),
  ('560015', 'Bangalore', 'Karnataka', 4),
  ('560016', 'Bangalore', 'Karnataka', 4),
  ('560017', 'Bangalore', 'Karnataka', 4),
  ('560018', 'Bangalore', 'Karnataka', 4),
  ('560019', 'Bangalore', 'Karnataka', 4),
  ('560020', 'Bangalore', 'Karnataka', 4),
  ('560021', 'Bangalore', 'Karnataka', 4),
  ('560022', 'Bangalore', 'Karnataka', 4),
  ('560023', 'Bangalore', 'Karnataka', 4),
  ('560024', 'Bangalore', 'Karnataka', 4),
  ('560025', 'Bangalore', 'Karnataka', 4),
  ('560026', 'Bangalore', 'Karnataka', 4),
  ('560027', 'Bangalore', 'Karnataka', 4),
  ('560029', 'Bangalore', 'Karnataka', 4),
  ('560030', 'Bangalore', 'Karnataka', 4),
  ('560032', 'Bangalore', 'Karnataka', 4),
  ('560033', 'Bangalore', 'Karnataka', 4),
  ('560034', 'Bangalore', 'Karnataka', 4),
  ('560035', 'Bangalore', 'Karnataka', 4),
  ('560036', 'Bangalore', 'Karnataka', 4),
  ('560037', 'Bangalore', 'Karnataka', 4),
  ('560038', 'Bangalore', 'Karnataka', 4),
  ('560039', 'Bangalore', 'Karnataka', 4),
  ('560040', 'Bangalore', 'Karnataka', 4),
  ('560041', 'Bangalore', 'Karnataka', 4),
  ('560042', 'Bangalore', 'Karnataka', 4),
  ('560043', 'Bangalore', 'Karnataka', 4),
  ('560045', 'Bangalore', 'Karnataka', 4),
  ('560046', 'Bangalore', 'Karnataka', 4),
  ('560047', 'Bangalore', 'Karnataka', 4),
  ('560048', 'Bangalore', 'Karnataka', 4),
  ('560049', 'Bangalore', 'Karnataka', 4),
  ('560050', 'Bangalore', 'Karnataka', 4),
  ('560051', 'Bangalore', 'Karnataka', 4),
  ('560052', 'Bangalore', 'Karnataka', 4),
  ('560053', 'Bangalore', 'Karnataka', 4),
  ('560054', 'Bangalore', 'Karnataka', 4),
  ('560055', 'Bangalore', 'Karnataka', 4),
  ('560056', 'Bangalore', 'Karnataka', 4),
  ('560057', 'Bangalore', 'Karnataka', 4),
  ('560058', 'Bangalore', 'Karnataka', 4),
  ('560059', 'Bangalore', 'Karnataka', 4),
  ('560060', 'Bangalore', 'Karnataka', 4),
  ('560061', 'Bangalore', 'Karnataka', 4),
  ('560062', 'Bangalore', 'Karnataka', 4),
  ('560063', 'Bangalore', 'Karnataka', 4),
  ('560064', 'Bangalore', 'Karnataka', 4),
  ('560065', 'Bangalore', 'Karnataka', 4),
  ('560066', 'Bangalore', 'Karnataka', 4),
  ('560067', 'Bangalore', 'Karnataka', 4),
  ('560068', 'Bangalore', 'Karnataka', 4),
  ('560069', 'Bangalore', 'Karnataka', 4),
  ('560070', 'Bangalore', 'Karnataka', 4),
  ('560071', 'Bangalore', 'Karnataka', 4),
  ('560072', 'Bangalore', 'Karnataka', 4),
  ('560073', 'Bangalore', 'Karnataka', 4),
  ('560074', 'Bangalore', 'Karnataka', 4),
  ('560075', 'Bangalore', 'Karnataka', 4),
  ('560076', 'Bangalore', 'Karnataka', 4),
  ('560077', 'Bangalore', 'Karnataka', 4),
  ('560078', 'Bangalore', 'Karnataka', 4),
  ('560079', 'Bangalore', 'Karnataka', 4),
  ('560080', 'Bangalore', 'Karnataka', 4),
  ('560081', 'Bangalore', 'Karnataka', 4),
  ('560082', 'Bangalore', 'Karnataka', 4),
  ('560083', 'Bangalore', 'Karnataka', 4),
  ('560084', 'Bangalore', 'Karnataka', 4),
  ('560085', 'Bangalore', 'Karnataka', 4),
  ('560086', 'Bangalore', 'Karnataka', 4),
  ('560087', 'Bangalore', 'Karnataka', 4),
  ('560088', 'Bangalore', 'Karnataka', 4),
  ('560089', 'Bangalore', 'Karnataka', 4),
  ('560090', 'Bangalore', 'Karnataka', 4),
  ('560091', 'Bangalore', 'Karnataka', 4),
  ('560092', 'Bangalore', 'Karnataka', 4),
  ('560093', 'Bangalore', 'Karnataka', 4),
  ('560094', 'Bangalore', 'Karnataka', 4),
  ('560095', 'Bangalore', 'Karnataka', 4),
  ('560096', 'Bangalore', 'Karnataka', 4),
  ('560097', 'Bangalore', 'Karnataka', 4),
  ('560098', 'Bangalore', 'Karnataka', 4),
  ('560099', 'Bangalore', 'Karnataka', 4),
  ('560100', 'Bangalore', 'Karnataka', 4),

  -- Tamil Nadu
  ('600001', 'Chennai', 'Tamil Nadu', 4),
  ('600002', 'Chennai', 'Tamil Nadu', 4),
  ('600003', 'Chennai', 'Tamil Nadu', 4),
  ('600004', 'Chennai', 'Tamil Nadu', 4),
  ('600005', 'Chennai', 'Tamil Nadu', 4),
  ('600006', 'Chennai', 'Tamil Nadu', 4),
  ('600007', 'Chennai', 'Tamil Nadu', 4),
  ('600008', 'Chennai', 'Tamil Nadu', 4),
  ('600009', 'Chennai', 'Tamil Nadu', 4),
  ('600010', 'Chennai', 'Tamil Nadu', 4),
  ('600011', 'Chennai', 'Tamil Nadu', 4),
  ('600012', 'Chennai', 'Tamil Nadu', 4),
  ('600014', 'Chennai', 'Tamil Nadu', 4),
  ('600015', 'Chennai', 'Tamil Nadu', 4),
  ('600016', 'Chennai', 'Tamil Nadu', 4),
  ('600017', 'Chennai', 'Tamil Nadu', 4),
  ('600018', 'Chennai', 'Tamil Nadu', 4),
  ('600019', 'Chennai', 'Tamil Nadu', 4),
  ('600020', 'Chennai', 'Tamil Nadu', 4),
  ('600021', 'Chennai', 'Tamil Nadu', 4),
  ('600022', 'Chennai', 'Tamil Nadu', 4),
  ('600023', 'Chennai', 'Tamil Nadu', 4),
  ('600024', 'Chennai', 'Tamil Nadu', 4),
  ('600025', 'Chennai', 'Tamil Nadu', 4),
  ('600026', 'Chennai', 'Tamil Nadu', 4),
  ('600027', 'Chennai', 'Tamil Nadu', 4),
  ('600028', 'Chennai', 'Tamil Nadu', 4),
  ('600029', 'Chennai', 'Tamil Nadu', 4),
  ('600030', 'Chennai', 'Tamil Nadu', 4),
  ('600031', 'Chennai', 'Tamil Nadu', 4),
  ('600032', 'Chennai', 'Tamil Nadu', 4),
  ('600033', 'Chennai', 'Tamil Nadu', 4),
  ('600034', 'Chennai', 'Tamil Nadu', 4),
  ('600035', 'Chennai', 'Tamil Nadu', 4),
  ('600036', 'Chennai', 'Tamil Nadu', 4),
  ('600037', 'Chennai', 'Tamil Nadu', 4),
  ('600038', 'Chennai', 'Tamil Nadu', 4),
  ('600039', 'Chennai', 'Tamil Nadu', 4),
  ('600040', 'Chennai', 'Tamil Nadu', 4),
  ('600041', 'Chennai', 'Tamil Nadu', 4),
  ('600042', 'Chennai', 'Tamil Nadu', 4),
  ('600044', 'Chennai', 'Tamil Nadu', 4),
  ('600045', 'Chennai', 'Tamil Nadu', 4),
  ('600046', 'Chennai', 'Tamil Nadu', 4),
  ('600047', 'Chennai', 'Tamil Nadu', 4),
  ('600048', 'Chennai', 'Tamil Nadu', 4),
  ('600049', 'Chennai', 'Tamil Nadu', 4),
  ('600050', 'Chennai', 'Tamil Nadu', 4),
  ('600051', 'Chennai', 'Tamil Nadu', 4),
  ('600052', 'Chennai', 'Tamil Nadu', 4),
  ('600053', 'Chennai', 'Tamil Nadu', 4),
  ('600054', 'Chennai', 'Tamil Nadu', 4),
  ('600055', 'Chennai', 'Tamil Nadu', 4),
  ('600056', 'Chennai', 'Tamil Nadu', 4),
  ('600057', 'Chennai', 'Tamil Nadu', 4),
  ('600058', 'Chennai', 'Tamil Nadu', 4),
  ('600059', 'Chennai', 'Tamil Nadu', 4),
  ('600060', 'Chennai', 'Tamil Nadu', 4),
  ('600061', 'Chennai', 'Tamil Nadu', 4),
  ('600062', 'Chennai', 'Tamil Nadu', 4),
  ('600063', 'Chennai', 'Tamil Nadu', 4),
  ('600064', 'Chennai', 'Tamil Nadu', 4),
  ('600065', 'Chennai', 'Tamil Nadu', 4),
  ('600066', 'Chennai', 'Tamil Nadu', 4),
  ('600067', 'Chennai', 'Tamil Nadu', 4),
  ('600068', 'Chennai', 'Tamil Nadu', 4),
  ('600069', 'Chennai', 'Tamil Nadu', 4),
  ('600070', 'Chennai', 'Tamil Nadu', 4),
  ('600071', 'Chennai', 'Tamil Nadu', 4),
  ('600073', 'Chennai', 'Tamil Nadu', 4),
  ('600074', 'Chennai', 'Tamil Nadu', 4),
  ('600075', 'Chennai', 'Tamil Nadu', 4),
  ('600076', 'Chennai', 'Tamil Nadu', 4),
  ('600077', 'Chennai', 'Tamil Nadu', 4),
  ('600078', 'Chennai', 'Tamil Nadu', 4),
  ('600079', 'Chennai', 'Tamil Nadu', 4),
  ('600080', 'Chennai', 'Tamil Nadu', 4),
  ('600081', 'Chennai', 'Tamil Nadu', 4),
  ('600082', 'Chennai', 'Tamil Nadu', 4),
  ('600083', 'Chennai', 'Tamil Nadu', 4),
  ('600084', 'Chennai', 'Tamil Nadu', 4),
  ('600085', 'Chennai', 'Tamil Nadu', 4),
  ('600086', 'Chennai', 'Tamil Nadu', 4),
  ('600087', 'Chennai', 'Tamil Nadu', 4),
  ('600088', 'Chennai', 'Tamil Nadu', 4),
  ('600089', 'Chennai', 'Tamil Nadu', 4),
  ('600090', 'Chennai', 'Tamil Nadu', 4),
  ('600091', 'Chennai', 'Tamil Nadu', 4),
  ('600092', 'Chennai', 'Tamil Nadu', 4),
  ('600093', 'Chennai', 'Tamil Nadu', 4),
  ('600094', 'Chennai', 'Tamil Nadu', 4),
  ('600095', 'Chennai', 'Tamil Nadu', 4),
  ('600096', 'Chennai', 'Tamil Nadu', 4),
  ('600097', 'Chennai', 'Tamil Nadu', 4),
  ('600098', 'Chennai', 'Tamil Nadu', 4),
  ('600099', 'Chennai', 'Tamil Nadu', 4),
  ('600100', 'Chennai', 'Tamil Nadu', 4),

  -- Telangana
  ('500001', 'Hyderabad', 'Telangana', 4),
  ('500002', 'Hyderabad', 'Telangana', 4),
  ('500003', 'Hyderabad', 'Telangana', 4),
  ('500004', 'Hyderabad', 'Telangana', 4),
  ('500005', 'Hyderabad', 'Telangana', 4),
  ('500006', 'Hyderabad', 'Telangana', 4),
  ('500007', 'Hyderabad', 'Telangana', 4),
  ('500008', 'Hyderabad', 'Telangana', 4),
  ('500009', 'Hyderabad', 'Telangana', 4),
  ('500010', 'Hyderabad', 'Telangana', 4),
  ('500011', 'Hyderabad', 'Telangana', 4),
  ('500012', 'Hyderabad', 'Telangana', 4),
  ('500013', 'Hyderabad', 'Telangana', 4),
  ('500015', 'Hyderabad', 'Telangana', 4),
  ('500016', 'Hyderabad', 'Telangana', 4),
  ('500017', 'Hyderabad', 'Telangana', 4),
  ('500018', 'Hyderabad', 'Telangana', 4),
  ('500019', 'Hyderabad', 'Telangana', 4),
  ('500020', 'Hyderabad', 'Telangana', 4),
  ('500022', 'Hyderabad', 'Telangana', 4),
  ('500023', 'Hyderabad', 'Telangana', 4),
  ('500024', 'Hyderabad', 'Telangana', 4),
  ('500025', 'Hyderabad', 'Telangana', 4),
  ('500026', 'Hyderabad', 'Telangana', 4),
  ('500027', 'Hyderabad', 'Telangana', 4),
  ('500028', 'Hyderabad', 'Telangana', 4),
  ('500029', 'Hyderabad', 'Telangana', 4),
  ('500030', 'Hyderabad', 'Telangana', 4),
  ('500031', 'Hyderabad', 'Telangana', 4),
  ('500032', 'Hyderabad', 'Telangana', 4),
  ('500033', 'Hyderabad', 'Telangana', 4),
  ('500034', 'Hyderabad', 'Telangana', 4),
  ('500035', 'Hyderabad', 'Telangana', 4),
  ('500036', 'Hyderabad', 'Telangana', 4),
  ('500037', 'Hyderabad', 'Telangana', 4),
  ('500038', 'Hyderabad', 'Telangana', 4),
  ('500039', 'Hyderabad', 'Telangana', 4),
  ('500040', 'Hyderabad', 'Telangana', 4),
  ('500041', 'Hyderabad', 'Telangana', 4),
  ('500042', 'Hyderabad', 'Telangana', 4),
  ('500044', 'Hyderabad', 'Telangana', 4),
  ('500045', 'Hyderabad', 'Telangana', 4),
  ('500046', 'Hyderabad', 'Telangana', 4),
  ('500047', 'Hyderabad', 'Telangana', 4),
  ('500048', 'Hyderabad', 'Telangana', 4),
  ('500049', 'Hyderabad', 'Telangana', 4),
  ('500050', 'Hyderabad', 'Telangana', 4),
  ('500051', 'Hyderabad', 'Telangana', 4),
  ('500052', 'Hyderabad', 'Telangana', 4),
  ('500053', 'Hyderabad', 'Telangana', 4),
  ('500054', 'Hyderabad', 'Telangana', 4),
  ('500055', 'Hyderabad', 'Telangana', 4),
  ('500056', 'Hyderabad', 'Telangana', 4),
  ('500057', 'Hyderabad', 'Telangana', 4),
  ('500058', 'Hyderabad', 'Telangana', 4),
  ('500059', 'Hyderabad', 'Telangana', 4),
  ('500060', 'Hyderabad', 'Telangana', 4),
  ('500061', 'Hyderabad', 'Telangana', 4),
  ('500062', 'Hyderabad', 'Telangana', 4),
  ('500063', 'Hyderabad', 'Telangana', 4),
  ('500064', 'Hyderabad', 'Telangana', 4),
  ('500065', 'Hyderabad', 'Telangana', 4),
  ('500066', 'Hyderabad', 'Telangana', 4),
  ('500067', 'Hyderabad', 'Telangana', 4),
  ('500068', 'Hyderabad', 'Telangana', 4),
  ('500069', 'Hyderabad', 'Telangana', 4),
  ('500070', 'Hyderabad', 'Telangana', 4),
  ('500072', 'Hyderabad', 'Telangana', 4),
  ('500073', 'Hyderabad', 'Telangana', 4),
  ('500074', 'Hyderabad', 'Telangana', 4),
  ('500075', 'Hyderabad', 'Telangana', 4),
  ('500076', 'Hyderabad', 'Telangana', 4),
  ('500077', 'Hyderabad', 'Telangana', 4),
  ('500078', 'Hyderabad', 'Telangana', 4),
  ('500079', 'Hyderabad', 'Telangana', 4),
  ('500080', 'Hyderabad', 'Telangana', 4),
  ('500081', 'Hyderabad', 'Telangana', 4),
  ('500082', 'Hyderabad', 'Telangana', 4),
  ('500083', 'Hyderabad', 'Telangana', 4),
  ('500084', 'Hyderabad', 'Telangana', 4),
  ('500085', 'Hyderabad', 'Telangana', 4),
  ('500086', 'Hyderabad', 'Telangana', 4),
  ('500087', 'Hyderabad', 'Telangana', 4),
  ('500088', 'Hyderabad', 'Telangana', 4),
  ('500089', 'Hyderabad', 'Telangana', 4),
  ('500090', 'Hyderabad', 'Telangana', 4),
  ('500091', 'Hyderabad', 'Telangana', 4),
  ('500092', 'Hyderabad', 'Telangana', 4),
  ('500093', 'Hyderabad', 'Telangana', 4),
  ('500094', 'Hyderabad', 'Telangana', 4),
  ('500095', 'Hyderabad', 'Telangana', 4),
  ('500096', 'Hyderabad', 'Telangana', 4),
  ('500097', 'Hyderabad', 'Telangana', 4),

  -- Gujarat
  ('380001', 'Ahmedabad', 'Gujarat', 4),
  ('380002', 'Ahmedabad', 'Gujarat', 4),
  ('380003', 'Ahmedabad', 'Gujarat', 4),
  ('380004', 'Ahmedabad', 'Gujarat', 4),
  ('380005', 'Ahmedabad', 'Gujarat', 4),
  ('380006', 'Ahmedabad', 'Gujarat', 4),
  ('380007', 'Ahmedabad', 'Gujarat', 4),
  ('380008', 'Ahmedabad', 'Gujarat', 4),
  ('380009', 'Ahmedabad', 'Gujarat', 4),
  ('380010', 'Ahmedabad', 'Gujarat', 4),
  ('380013', 'Ahmedabad', 'Gujarat', 4),
  ('380014', 'Ahmedabad', 'Gujarat', 4),
  ('380015', 'Ahmedabad', 'Gujarat', 4),
  ('380016', 'Ahmedabad', 'Gujarat', 4),
  ('380018', 'Ahmedabad', 'Gujarat', 4),
  ('380019', 'Ahmedabad', 'Gujarat', 4),
  ('380021', 'Ahmedabad', 'Gujarat', 4),
  ('380022', 'Ahmedabad', 'Gujarat', 4),
  ('380023', 'Ahmedabad', 'Gujarat', 4),
  ('380024', 'Ahmedabad', 'Gujarat', 4),
  ('380025', 'Ahmedabad', 'Gujarat', 4),
  ('380026', 'Ahmedabad', 'Gujarat', 4),
  ('380027', 'Ahmedabad', 'Gujarat', 4),
  ('380028', 'Ahmedabad', 'Gujarat', 4),
  ('380050', 'Ahmedabad', 'Gujarat', 4),
  ('380051', 'Ahmedabad', 'Gujarat', 4),
  ('380052', 'Ahmedabad', 'Gujarat', 4),
  ('380053', 'Ahmedabad', 'Gujarat', 4),
  ('380054', 'Ahmedabad', 'Gujarat', 4),
  ('380055', 'Ahmedabad', 'Gujarat', 4),
  ('380058', 'Ahmedabad', 'Gujarat', 4),
  ('380059', 'Ahmedabad', 'Gujarat', 4),
  ('380060', 'Ahmedabad', 'Gujarat', 4),
  ('380061', 'Ahmedabad', 'Gujarat', 4),
  ('380063', 'Ahmedabad', 'Gujarat', 4)

ON CONFLICT (pincode) DO NOTHING;

-- ============================================================================
-- 5. HELPER FUNCTIONS
-- ============================================================================

-- Function to update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
   NEW.updated_at = now();
   RETURN NEW;
END;
$$ language 'plpgsql';

-- Trigger for user_addresses
DROP TRIGGER IF EXISTS update_user_addresses_updated_at ON public.user_addresses;
CREATE TRIGGER update_user_addresses_updated_at
  BEFORE UPDATE ON public.user_addresses
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- Trigger for supported_pincodes
DROP TRIGGER IF EXISTS update_supported_pincodes_updated_at ON public.supported_pincodes;
CREATE TRIGGER update_supported_pincodes_updated_at
  BEFORE UPDATE ON public.supported_pincodes
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- ============================================================================
-- DONE! Run this script in Supabase SQL Editor
-- ============================================================================
